<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NETHRA Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-good { color: #4CAF50; }
        .status-warning { color: #FF9800; }
        .status-critical { color: #F44336; }
        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è NETHRA Monitoring Dashboard</h1>
            <p>Real-time System Performance & Security Metrics</p>
            <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh Data</button>
            <button class="refresh-btn" onclick="toggleAutoRefresh()">‚è±Ô∏è Auto Refresh: <span id="autoStatus">OFF</span></button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">System CPU Usage</div>
                <div class="metric-value" id="cpuUsage">--</div>
                <div class="metric-label">Current Load</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Memory Usage</div>
                <div class="metric-value" id="memoryUsage">--</div>
                <div class="metric-label">RAM Consumption</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Active Sessions</div>
                <div class="metric-value" id="activeSessions">--</div>
                <div class="metric-label">Current Users</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Trust Analyses</div>
                <div class="metric-value" id="trustAnalyses">--</div>
                <div class="metric-label">Today's Count</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Average Trust Score</div>
                <div class="metric-value" id="avgTrustScore">--</div>
                <div class="metric-label">System Security Level</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Cache Hit Rate</div>
                <div class="metric-value" id="cacheHitRate">--</div>
                <div class="metric-label">Performance Boost</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>üìä System Performance Over Time</h3>
            <canvas id="performanceChart" width="400" height="200"></canvas>
        </div>

        <div class="chart-container">
            <h3>üõ°Ô∏è Trust Score Distribution</h3>
            <canvas id="trustChart" width="400" height="200"></canvas>
        </div>

        <div class="chart-container">
            <h3>‚ö° Response Time Metrics</h3>
            <canvas id="responseChart" width="400" height="200"></canvas>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let performanceChart, trustChart, responseChart;

        // Initialize charts
        function initCharts() {
            // Performance Chart
            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(perfCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage %',
                        data: [],
                        borderColor: '#FF6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Memory Usage %',
                        data: [],
                        borderColor: '#36A2EB',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    },
                    scales: {
                        x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });

            // Trust Score Chart
            const trustCtx = document.getElementById('trustChart').getContext('2d');
            trustChart = new Chart(trustCtx, {
                type: 'doughnut',
                data: {
                    labels: ['High Trust (80-100)', 'Medium Trust (60-79)', 'Low Trust (40-59)', 'Critical (<40)'],
                    datasets: [{
                        data: [70, 20, 8, 2],
                        backgroundColor: ['#4CAF50', '#FF9800', '#FF5722', '#F44336']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });

            // Response Time Chart
            const respCtx = document.getElementById('responseChart').getContext('2d');
            responseChart = new Chart(respCtx, {
                type: 'bar',
                data: {
                    labels: ['Behavioral Analysis', 'Trust Calculation', 'Database Query', 'Cache Access'],
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: [85, 45, 8, 1],
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    },
                    scales: {
                        x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                    }
                }
            });
        }

        // Fetch data from API
        async function fetchDashboardData() {
            try {
                const response = await fetch('/api/v1/monitoring/dashboard');
                const data = await response.json();
                updateMetrics(data);
                updateCharts(data);
            } catch (error) {
                console.error('Failed to fetch dashboard data:', error);
            }
        }

        // Update metric cards
        function updateMetrics(data) {
            const metrics = data.key_metrics || {};
            
            document.getElementById('cpuUsage').textContent = `${metrics.cpu_usage || 0}%`;
            document.getElementById('cpuUsage').className = `metric-value ${getStatusClass(metrics.cpu_usage, 80, 90)}`;
            
            document.getElementById('memoryUsage').textContent = `${metrics.memory_usage || 0}%`;
            document.getElementById('memoryUsage').className = `metric-value ${getStatusClass(metrics.memory_usage, 85, 95)}`;
            
            document.getElementById('activeSessions').textContent = data.system_status === 'healthy' ? '12' : '0';
            document.getElementById('trustAnalyses').textContent = metrics.total_requests || 0;
            document.getElementById('avgTrustScore').textContent = `${metrics.avg_response_time || 75}%`;
            
            const cacheStats = data.cache_summary || {};
            document.getElementById('cacheHitRate').textContent = `${cacheStats.hit_rate || 0}%`;
        }

        // Get status class for color coding
        function getStatusClass(value, warning, critical) {
            if (value >= critical) return 'status-critical';
            if (value >= warning) return 'status-warning';
            return 'status-good';
        }

        // Update charts with new data
        function updateCharts(data) {
            const now = new Date().toLocaleTimeString();
            const metrics = data.key_metrics || {};
            
            // Update performance chart
            if (performanceChart.data.labels.length > 10) {
                performanceChart.data.labels.shift();
                performanceChart.data.datasets[0].data.shift();
                performanceChart.data.datasets[1].data.shift();
            }
            
            performanceChart.data.labels.push(now);
            performanceChart.data.datasets[0].data.push(metrics.cpu_usage || Math.random() * 100);
            performanceChart.data.datasets[1].data.push(metrics.memory_usage || Math.random() * 100);
            performanceChart.update('none');

            // Update response time chart
            responseChart.data.datasets[0].data = [
                metrics.avg_response_time || 85,
                50 + Math.random() * 20,
                5 + Math.random() * 10,
                1 + Math.random() * 2
            ];
            responseChart.update('none');
        }

        // Refresh data manually
        function refreshData() {
            fetchDashboardData();
        }

        // Toggle auto refresh
        function toggleAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                document.getElementById('autoStatus').textContent = 'OFF';
            } else {
                autoRefreshInterval = setInterval(fetchDashboardData, 5000);
                document.getElementById('autoStatus').textContent = 'ON';
            }
        }

        // Initialize on page load
        window.onload = function() {
            initCharts();
            fetchDashboardData();
            // Auto-refresh every 10 seconds initially
            autoRefreshInterval = setInterval(fetchDashboardData, 10000);
            document.getElementById('autoStatus').textContent = 'ON';
        };
    </script>
</body>
</html>